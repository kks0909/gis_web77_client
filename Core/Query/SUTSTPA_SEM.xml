<?xml version="1.0" encoding="utf-8"?>
<root version="7.7.7.7" descr="СУ ТС ТПА">
    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_INF" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>

    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_TO" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>

    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_OPER" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>

    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_EXP" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>

    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_EPB" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>

    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН_CHECK" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
    </data>
    <data table="VALVE" schema="SUTSTPA" id="SUTSTPA_КРАН" comment="VALVE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
valve as (select 
id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
to_char(date_to1,'DD.MM.YYYY') date_to1, result_to1,to_char(date_to2,'DD.MM.YYYY')  date_to2, result_to2,to_char(date_tr,'DD.MM.YYYY')  date_tr, result_tr,to_char(date_sr,'DD.MM.YYYY')  date_sr, result_sr, operator4, operator5, operator6, 
to_char(date_insp,'DD.MM.YYYY') date_insp, to_char(date_manuf,'DD.MM.YYYY') date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, execution_type_id, electric_drive_descr, 
electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, to_char(date_install,'DD.MM.YYYY')  date_install, to_char(date_work_begin,'DD.MM.YYYY') date_work_begin, climatic_type_id, invent_number, lifetime, 
to_char(date_exp,'DD.MM.YYYY') date_exp,to_char(date_epb1_plan,'DD.MM.YYYY')  date_epb1_plan,to_char(date_epb1_fact,'DD.MM.YYYY')  date_epb1_fact, result_epb1,to_char(date_epb2_plan,'DD.MM.YYYY')  date_epb2_plan, 
to_char(date_epb2_fact,'DD.MM.YYYY') date_epb2_fact, result_epb2, to_char(date_epb_next_plan,'DD.MM.YYYY') date_epb_next_plan,to_char(date_epb_next_fact,'DD.MM.YYYY')  date_epb_next_fact, result_epb_next, lubricant_value, 
hydrofluid_value, passport_document_descr, work_pressure_fact, work_temp_project, work_temp_fact, to_char(date_repair,'DD.MM.YYYY') date_repair, serial_number_repair, repair_descr, to_char(date_dtoir_plan,'DD.MM.YYYY') date_dtoir_plan, 
to_char(date_dtoir_fact,'DD.MM.YYYY') date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, 
hydrofluid_cons_fact_year, leak_descr, to_char(date_leak_detect,'DD.MM.YYYY') date_leak_detect, to_char(date_leak_fix,'DD.MM.YYYY') date_leak_fix, shutter_tight_descr, to_char(date_untight_detect,'DD.MM.YYYY') date_untight_detect, 
to_char(date_untight_fix,'DD.MM.YYYY') date_untight_fix, oper_manuf_id, to_char(oper_date_manuf,'DD.MM.YYYY') oper_date_manuf, oper_label_type_id, oper_serial_number, to_char(oper_date_work_begin,'DD.MM.YYYY') oper_date_work_begin, 
order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, to_char(date_to_lubricant_plan,'DD.MM.YYYY') date_to_lubricant_plan, 
to_char(date_to_lubricant_fact,'DD.MM.YYYY') date_to_lubricant_fact, to_char(date_rso,'DD.MM.YYYY') date_rso,  add_is_1, add_is_2, add_is_3, add_is_4,
coalesce(ext_corr_1_is,0)*k_ext_corr_1_is+coalesce(ext_corr_2_is,0)*k_ext_corr_2_is+coalesce(ext_corr_3_is,0)*k_ext_corr_3_is+coalesce(ground_1_is,0)*k_ground_1_is+coalesce(ground_2_is,0)*k_ground_2_is+coalesce(ground_3_is,0)*k_ground_3_is
+coalesce(ground_4_is,0)*k_ground_4_is+coalesce(ground_5_is,0)*k_ground_5_is+abs(1-coalesce(color_1_is,1))*k_color_1_is+abs(1-coalesce(color_2_is,1))*k_color_2_is+abs(1-coalesce(color_3_is,1))*k_color_3_is
+abs(1-coalesce(color_4_is,1))*k_color_4_is+abs(1-coalesce(color_5_is,1))*k_color_5_is+abs(1-coalesce(color_6_is,1))*k_color_6_is+abs(1-coalesce(inf_1_is,1))*k_inf_1_is+abs(1-coalesce(inf_2_is,1))*k_inf_2_is
+abs(1-coalesce(inf_3_is,1))*k_inf_3_is+abs(1-coalesce(inf_4_is,1))*k_inf_4_is+abs(1-coalesce(inf_5_is,1))*k_inf_5_is+(cASE WHEN v.date_manuf is null THEN 1 else 0 end)*k_INF_DATE_MANUF_IS
+(cASE WHEN v.manuf_id is null THEN 1 else 0 end)*k_INF_MANUF_IS +coalesce(order_6_is,0)*k_order_6_is+abs(1-coalesce(cont_meas_2_is,1))*k_cont_meas_2_is+abs(1-coalesce(cont_meas_3_is,1))*k_cont_meas_3_is
+abs(1-coalesce(cont_meas_4_is,1))*k_cont_meas_4_is+abs(1-coalesce(cont_meas_5_is,1))*k_cont_meas_5_is+abs(1-coalesce(cont_meas_6_is,1))*k_cont_meas_6_is+abs(1-coalesce(cont_meas_7_is,1))*k_cont_meas_7_is
+coalesce(add_is_1,0)*k_add_is_1+coalesce(add_is_2,0)*k_add_is_2+coalesce(add_is_3,0)*k_add_is_3+coalesce(add_is_4,0)*k_add_is_4 rank
FROM sutstpa.valve v,koef k)
                SELECT id, lpu, les, pipe, station, type_id, oper_type_id, name_id, tech_num, tech_num_is, joint_id, plate_is, nom_diam_id, nom_press_id, descr, serial_num, manuf_id, ext_corr_1_is, ext_corr_2_is, ext_corr_3_is, ground_1_is, 
ground_2_is, ground_3_is, ground_4_is, ground_5_is, color_1_is, color_2_is, color_3_is, color_4_is, color_5_is, color_6_is, inf_1_is, inf_2_is, inf_3_is, inf_4_is, inf_5_is, operator1, operator2, operator3, 
date_to1, result_to1, date_to2, result_to2, date_tr, result_tr, date_sr, result_sr, operator4, operator5, operator6, date_insp, date_manuf, struct_id, inf_6_is, material_id, install_type_id, func_type_id, 
execution_type_id, electric_drive_descr, electric_drive_ready_descr, tpa_figure_type_id, tpa_constr_type_id, date_install, date_work_begin, climatic_type_id, invent_number, lifetime, 
date_exp, date_epb1_plan, date_epb1_fact, result_epb1, date_epb2_plan, date_epb2_fact, result_epb2, date_epb_next_plan, date_epb_next_fact, result_epb_next, lubricant_value, hydrofluid_value, passport_document_descr, 
work_pressure_fact, work_temp_project, work_temp_fact, date_repair, serial_number_repair, repair_descr, date_dtoir_plan, date_dtoir_fact, seal_past_cons_plan, seal_past_cons_fact, hydrofluid_cons_plan, hydrofluid_cons_fact, 
seal_past_cons_plan_year, seal_past_cons_plan_fact, hydrofluid_cons_plan_year, hydrofluid_cons_fact_year, leak_descr, date_leak_detect, date_leak_fix, shutter_tight_descr, date_untight_detect, date_untight_fix, oper_manuf_id, 
oper_date_manuf, oper_label_type_id, oper_serial_number, oper_date_work_begin, order_6_is,   cont_meas_2_is, cont_meas_3_is, cont_meas_4_is, cont_meas_5_is, cont_meas_6_is, cont_meas_7_is, 
infoteh_is, infoteh_correction, infoteh_col_cor_list, infoteh_comment, date_to_lubricant_plan, date_to_lubricant_fact, date_rso, add_is_1, add_is_2, add_is_3, add_is_4, rank,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED' 
		   end "TYPE" 					
					FROM valve v, sum_koef sum_k where sum_k.check_table='sutstpa.valve' and {FILTER}
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
            <query>
                    INSERT INTO sutstpa.valve
(
lg_attach,
lpu,
les,
pipe,
station,
type_id,
oper_type_id,
name_id,
tech_num,
tech_num_is,
joint_id,
plate_is,
nom_diam_id,
nom_press_id,
descr,
serial_num,
manuf_id,
ext_corr_1_is,
ext_corr_2_is,
ext_corr_3_is,
ground_1_is,
ground_2_is,
ground_3_is,
ground_4_is,
ground_5_is,
color_1_is,
color_2_is,
color_3_is,
color_4_is,
color_5_is,
color_6_is,
inf_1_is,
inf_2_is,
inf_3_is,
inf_4_is,
inf_5_is,
operator1,
operator2,
operator3,
date_to1,
result_to1,
date_to2,
result_to2,
date_tr,
result_tr,
date_sr,
result_sr,
operator4,
operator5,
operator6,
date_insp,
date_manuf,
struct_id,
inf_6_is,
material_id,
install_type_id,
func_type_id,
execution_type_id,
electric_drive_descr,
electric_drive_ready_descr,
tpa_figure_type_id,
tpa_constr_type_id,
date_install,
date_work_begin,
climatic_type_id,
invent_number,
lifetime,
date_exp,
date_epb1_plan,
date_epb1_fact,
result_epb1,
date_epb2_plan,
date_epb2_fact,
result_epb2,
date_epb_next_plan,
date_epb_next_fact,
result_epb_next,
lubricant_value,
hydrofluid_value,
passport_document_descr,
work_pressure_fact,
work_temp_project,
work_temp_fact,
date_repair,
serial_number_repair,
repair_descr,
date_dtoir_plan,
date_dtoir_fact,
seal_past_cons_plan,
seal_past_cons_fact,
hydrofluid_cons_plan,
hydrofluid_cons_fact,
seal_past_cons_plan_year,
seal_past_cons_plan_fact,
hydrofluid_cons_plan_year,
hydrofluid_cons_fact_year,
leak_descr,
date_leak_detect,
date_leak_fix,
shutter_tight_descr,
date_untight_detect,
date_untight_fix,
oper_manuf_id,
oper_date_manuf,
oper_label_type_id,
oper_serial_number,
oper_date_work_begin,
order_6_is,
cont_meas_2_is,
cont_meas_3_is,
cont_meas_4_is,
cont_meas_5_is,
cont_meas_6_is,
cont_meas_7_is,
infoteh_is,
infoteh_correction,
infoteh_col_cor_list,
infoteh_comment,
date_to_lubricant_plan,
date_to_lubricant_fact,
date_rso,
add_is_1,
add_is_2,
add_is_3,
add_is_4
)
VALUES(  
:LG_ATTACH,
:LPU,
:LES,
:PIPE,
:STATION,
:TYPE_ID,
:OPER_TYPE_ID,
:NAME_ID,
:TECH_NUM,
:TECH_NUM_IS,
:JOINT_ID,
:PLATE_IS,
:NOM_DIAM_ID,
:NOM_PRESS_ID,
:DESCR,
:SERIAL_NUM,
:MANUF_ID,
:EXT_CORR_1_IS,
:EXT_CORR_2_IS,
:EXT_CORR_3_IS,
:GROUND_1_IS,
:GROUND_2_IS,
:GROUND_3_IS,
:GROUND_4_IS,
:GROUND_5_IS,
:COLOR_1_IS,
:COLOR_2_IS,
:COLOR_3_IS,
:COLOR_4_IS,
:COLOR_5_IS,
:COLOR_6_IS,
:INF_1_IS,
:INF_2_IS,
:INF_3_IS,
:INF_4_IS,
:INF_5_IS,
:OPERATOR1,
:OPERATOR2,
:OPERATOR3,
:DATE_TO1,
:RESULT_TO1,
:DATE_TO2,
:RESULT_TO2,
:DATE_TR,
:RESULT_TR,
:DATE_SR,
:RESULT_SR,
:OPERATOR4,
:OPERATOR5,
:OPERATOR6,
:DATE_INSP,
:DATE_MANUF,
:STRUCT_ID,
:INF_6_IS,
:MATERIAL_ID,
:INSTALL_TYPE_ID,
:FUNC_TYPE_ID,
:EXECUTION_TYPE_ID,
:ELECTRIC_DRIVE_DESCR,
:ELECTRIC_DRIVE_READY_DESCR,
:TPA_FIGURE_TYPE_ID,
:TPA_CONSTR_TYPE_ID,
:DATE_INSTALL,
:DATE_WORK_BEGIN,
:CLIMATIC_TYPE_ID,
:INVENT_NUMBER,
:LIFETIME,
:DATE_EXP,
:DATE_EPB1_PLAN,
:DATE_EPB1_FACT,
:RESULT_EPB1,
:DATE_EPB2_PLAN,
:DATE_EPB2_FACT,
:RESULT_EPB2,
:DATE_EPB_NEXT_PLAN,
:DATE_EPB_NEXT_FACT,
:RESULT_EPB_NEXT,
:LUBRICANT_VALUE,
:HYDROFLUID_VALUE,
:PASSPORT_DOCUMENT_DESCR,
:WORK_PRESSURE_FACT,
:WORK_TEMP_PROJECT,
:WORK_TEMP_FACT,
:DATE_REPAIR,
:SERIAL_NUMBER_REPAIR,
:REPAIR_DESCR,
:DATE_DTOIR_PLAN,
:DATE_DTOIR_FACT,
:SEAL_PAST_CONS_PLAN,
:SEAL_PAST_CONS_FACT,
:HYDROFLUID_CONS_PLAN,
:HYDROFLUID_CONS_FACT,
:SEAL_PAST_CONS_PLAN_YEAR,
:SEAL_PAST_CONS_PLAN_FACT,
:HYDROFLUID_CONS_PLAN_YEAR,
:HYDROFLUID_CONS_FACT_YEAR,
:LEAK_DESCR,
:DATE_LEAK_DETECT,
:DATE_LEAK_FIX,
:SHUTTER_TIGHT_DESCR,
:DATE_UNTIGHT_DETECT,
:DATE_UNTIGHT_FIX,
:OPER_MANUF_ID,
:OPER_DATE_MANUF,
:OPER_LABEL_TYPE_ID,
:OPER_SERIAL_NUMBER,
:OPER_DATE_WORK_BEGIN,
:ORDER_6_IS,
:CONT_MEAS_2_IS,
:CONT_MEAS_3_IS,
:CONT_MEAS_4_IS,
:CONT_MEAS_5_IS,
:CONT_MEAS_6_IS,
:CONT_MEAS_7_IS,
:INFOTEH_IS,
:INFOTEH_CORRECTION,
:INFOTEH_COL_COR_LIST,
:INFOTEH_COMMENT,
:DATE_TO_LUBRICANT_PLAN,
:DATE_TO_LUBRICANT_FACT,
:DATE_RSO,
:ADD_IS_1,
:ADD_IS_2,
:ADD_IS_3,
:ADD_IS_4
)
            </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="LG_ATTACH" default="" type="String"/>
<param name="LPU" default="" type="String"/>
<param name="LES" default="" type="String"/>
<param name="PIPE" default="" type="String"/>
<param name="STATION" default="" type="Decimal"/>
<param name="TYPE_ID" default="" type="String"/>
<param name="OPER_TYPE_ID" default="" type="String"/>
<param name="NAME_ID" default="" type="String"/>
<param name="TECH_NUM" default="" type="String"/>
<param name="TECH_NUM_IS" default="" type="Decimal"/>
<param name="JOINT_ID" default="" type="String"/>
<param name="PLATE_IS" default="" type="Decimal"/>
<param name="NOM_DIAM_ID" default="" type="Decimal"/>
<param name="NOM_PRESS_ID" default="" type="Decimal"/>
<param name="DESCR" default="" type="String"/>
<param name="SERIAL_NUM" default="" type="String"/>
<param name="MANUF_ID" default="" type="String"/>
<param name="EXT_CORR_1_IS" default="" type="Decimal"/>
<param name="EXT_CORR_2_IS" default="" type="Decimal"/>
<param name="EXT_CORR_3_IS" default="" type="Decimal"/>
<param name="GROUND_1_IS" default="" type="Decimal"/>
<param name="GROUND_2_IS" default="" type="Decimal"/>
<param name="GROUND_3_IS" default="" type="Decimal"/>
<param name="GROUND_4_IS" default="" type="Decimal"/>
<param name="GROUND_5_IS" default="" type="Decimal"/>
<param name="COLOR_1_IS" default="" type="Decimal"/>
<param name="COLOR_2_IS" default="" type="Decimal"/>
<param name="COLOR_3_IS" default="" type="Decimal"/>
<param name="COLOR_4_IS" default="" type="Decimal"/>
<param name="COLOR_5_IS" default="" type="Decimal"/>
<param name="COLOR_6_IS" default="" type="Decimal"/>
<param name="INF_1_IS" default="" type="Decimal"/>
<param name="INF_2_IS" default="" type="Decimal"/>
<param name="INF_3_IS" default="" type="Decimal"/>
<param name="INF_4_IS" default="" type="Decimal"/>
<param name="INF_5_IS" default="" type="Decimal"/>
<param name="OPERATOR1" default="" type="Decimal"/>
<param name="OPERATOR2" default="" type="Decimal"/>
<param name="OPERATOR3" default="" type="Decimal"/>
<param name="DATE_TO1" default="" type="DateTime"/>
<param name="RESULT_TO1" default="" type="String"/>
<param name="DATE_TO2" default="" type="DateTime"/>
<param name="RESULT_TO2" default="" type="String"/>
<param name="DATE_TR" default="" type="DateTime"/>
<param name="RESULT_TR" default="" type="String"/>
<param name="DATE_SR" default="" type="DateTime"/>
<param name="RESULT_SR" default="" type="String"/>
<param name="OPERATOR4" default="" type="Decimal"/>
<param name="OPERATOR5" default="" type="Decimal"/>
<param name="OPERATOR6" default="" type="Decimal"/>
<param name="DATE_INSP" default="" type="DateTime"/>
<param name="DATE_MANUF" default="" type="DateTime"/>
<param name="STRUCT_ID" default="" type="Decimal"/>
<param name="INF_6_IS" default="" type="Decimal"/>
<param name="MATERIAL_ID" default="" type="String"/>
<param name="INSTALL_TYPE_ID" default="" type="String"/>
<param name="FUNC_TYPE_ID" default="" type="String"/>
<param name="EXECUTION_TYPE_ID" default="" type="String"/>
<param name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
<param name="ELECTRIC_DRIVE_DESCR" default="" type="String"/>
<param name="ELECTRIC_DRIVE_READY_DESCR" default="" type="Decimal"/>
<param name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
<param name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
<param name="DATE_INSTALL" default="" type="DateTime"/>
<param name="DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="CLIMATIC_TYPE_ID" default="" type="String"/>
<param name="INVENT_NUMBER" default="" type="String"/>
<param name="LIFETIME" default="" type="Decimal"/>
<param name="DATE_EXP" default="" type="DateTime"/>
<param name="DATE_EPB1_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB1_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB1" default="" type="String"/>
<param name="DATE_EPB2_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB2_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB2" default="" type="String"/>
<param name="DATE_EPB_NEXT_PLAN" default="" type="DateTime"/>
<param name="DATE_EPB_NEXT_FACT" default="" type="DateTime"/>
<param name="RESULT_EPB_NEXT" default="" type="String"/>
<param name="LUBRICANT_VALUE" default="" type="Decimal"/>
<param name="HYDROFLUID_VALUE" default="" type="Decimal"/>
<param name="PASSPORT_DOCUMENT_DESCR" default="" type="String"/>
<param name="WORK_PRESSURE_FACT" default="" type="Decimal"/>
<param name="WORK_TEMP_PROJECT" default="" type="Decimal"/>
<param name="WORK_TEMP_FACT" default="" type="Decimal"/>
<param name="DATE_REPAIR" default="" type="DateTime"/>
<param name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
<param name="REPAIR_DESCR" default="" type="String"/>
<param name="DATE_DTOIR_PLAN" default="" type="DateTime"/>
<param name="DATE_DTOIR_FACT" default="" type="DateTime"/>
<param name="SEAL_PAST_CONS_PLAN" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="SEAL_PAST_CONS_PLAN_FACT" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_PLAN_YEAR" default="" type="Decimal"/>
<param name="HYDROFLUID_CONS_FACT_YEAR" default="" type="Decimal"/>
<param name="LEAK_DESCR" default="" type="String"/>
<param name="DATE_LEAK_DETECT" default="" type="DateTime"/>
<param name="DATE_LEAK_FIX" default="" type="DateTime"/>
<param name="SHUTTER_TIGHT_DESCR" default="" type="String"/>
<param name="DATE_UNTIGHT_DETECT" default="" type="DateTime"/>
<param name="DATE_UNTIGHT_FIX" default="" type="DateTime"/>
<param name="OPER_MANUF_ID" default="" type="String"/>
<param name="OPER_DATE_MANUF" default="" type="DateTime"/>
<param name="OPER_LABEL_TYPE_ID" default="" type="String"/>
<param name="OPER_SERIAL_NUMBER" default="" type="String"/>
<param name="OPER_MANUF_TYPE_ID" default="" type="String"/>
<param name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
<param name="ORDER_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
<param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
<param name="INFOTEH_IS" default="" type="Decimal"/>
<param name="INFOTEH_CORRECTION" default="" type="String"/>
<param name="INFOTEH_COL_COR_LIST" default="" type="String"/>
<param name="INFOTEH_COMMENT" default="" type="String"/>
<param name="DATE_TO_LUBRICANT_PLAN" default="" type="DateTime"/>
<param name="DATE_TO_LUBRICANT_FACT" default="" type="DateTime"/>
<param name="DATE_RSO" default="" type="DateTime"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="ADD_IS_1" default="" type="Decimal"/>
<param name="ADD_IS_2" default="" type="Decimal"/>
<param name="ADD_IS_3" default="" type="Decimal"/>
<param name="ADD_IS_4" default="" type="Decimal"/>
<var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.valve"/>
                <query>
                    UPDATE sutstpa.valve
                SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
TYPE_ID=:TYPE_ID,
OPER_TYPE_ID=:OPER_TYPE_ID,
NAME_ID=:NAME_ID,
TECH_NUM=:TECH_NUM,
TECH_NUM_IS=:TECH_NUM_IS,
JOINT_ID=:JOINT_ID,
PLATE_IS=:PLATE_IS,
NOM_DIAM_ID=:NOM_DIAM_ID,
NOM_PRESS_ID=:NOM_PRESS_ID,
DESCR=:DESCR,
SERIAL_NUM=:SERIAL_NUM,
MANUF_ID=:MANUF_ID,
EXT_CORR_1_IS=:EXT_CORR_1_IS,
EXT_CORR_2_IS=:EXT_CORR_2_IS,
EXT_CORR_3_IS=:EXT_CORR_3_IS,
GROUND_1_IS=:GROUND_1_IS,
GROUND_2_IS=:GROUND_2_IS,
GROUND_3_IS=:GROUND_3_IS,
GROUND_4_IS=:GROUND_4_IS,
GROUND_5_IS=:GROUND_5_IS,
COLOR_1_IS=:COLOR_1_IS,
COLOR_2_IS=:COLOR_2_IS,
COLOR_3_IS=:COLOR_3_IS,
COLOR_4_IS=:COLOR_4_IS,
COLOR_5_IS=:COLOR_5_IS,
COLOR_6_IS=:COLOR_6_IS,
INF_1_IS=:INF_1_IS,
INF_2_IS=:INF_2_IS,
INF_3_IS=:INF_3_IS,
INF_4_IS=:INF_4_IS,
INF_5_IS=:INF_5_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
DATE_TO1=:DATE_TO1,
RESULT_TO1=:RESULT_TO1,
DATE_TO2=:DATE_TO2,
RESULT_TO2=:RESULT_TO2,
DATE_TR=:DATE_TR,
RESULT_TR=:RESULT_TR,
DATE_SR=:DATE_SR,
RESULT_SR=:RESULT_SR,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_MANUF=:DATE_MANUF,
STRUCT_ID=:STRUCT_ID,
INF_6_IS=:INF_6_IS,
MATERIAL_ID=:MATERIAL_ID,
INSTALL_TYPE_ID=:INSTALL_TYPE_ID,
FUNC_TYPE_ID=:FUNC_TYPE_ID,
EXECUTION_TYPE_ID=:EXECUTION_TYPE_ID,
ELECTRIC_DRIVE_DESCR=:ELECTRIC_DRIVE_DESCR,
ELECTRIC_DRIVE_READY_DESCR=:ELECTRIC_DRIVE_READY_DESCR,
TPA_FIGURE_TYPE_ID=:TPA_FIGURE_TYPE_ID,
TPA_CONSTR_TYPE_ID=:TPA_CONSTR_TYPE_ID,
DATE_INSTALL=:DATE_INSTALL,
DATE_WORK_BEGIN=:DATE_WORK_BEGIN,
CLIMATIC_TYPE_ID=:CLIMATIC_TYPE_ID,
INVENT_NUMBER=:INVENT_NUMBER,
LIFETIME=:LIFETIME,
DATE_EXP=:DATE_EXP,
DATE_EPB1_PLAN=:DATE_EPB1_PLAN,
DATE_EPB1_FACT=:DATE_EPB1_FACT,
RESULT_EPB1=:RESULT_EPB1,
DATE_EPB2_PLAN=:DATE_EPB2_PLAN,
DATE_EPB2_FACT=:DATE_EPB2_FACT,
RESULT_EPB2=:RESULT_EPB2,
DATE_EPB_NEXT_PLAN=:DATE_EPB_NEXT_PLAN,
DATE_EPB_NEXT_FACT=:DATE_EPB_NEXT_FACT,
RESULT_EPB_NEXT=:RESULT_EPB_NEXT,
LUBRICANT_VALUE=:LUBRICANT_VALUE,
HYDROFLUID_VALUE=:HYDROFLUID_VALUE,
PASSPORT_DOCUMENT_DESCR=:PASSPORT_DOCUMENT_DESCR,
WORK_PRESSURE_FACT=:WORK_PRESSURE_FACT,
WORK_TEMP_PROJECT=:WORK_TEMP_PROJECT,
WORK_TEMP_FACT=:WORK_TEMP_FACT,
DATE_REPAIR=:DATE_REPAIR,
SERIAL_NUMBER_REPAIR=:SERIAL_NUMBER_REPAIR,
REPAIR_DESCR=:REPAIR_DESCR,
DATE_DTOIR_PLAN=:DATE_DTOIR_PLAN,
DATE_DTOIR_FACT=:DATE_DTOIR_FACT,
SEAL_PAST_CONS_PLAN=:SEAL_PAST_CONS_PLAN,
SEAL_PAST_CONS_FACT=:SEAL_PAST_CONS_FACT,
HYDROFLUID_CONS_PLAN=:HYDROFLUID_CONS_PLAN,
HYDROFLUID_CONS_FACT=:HYDROFLUID_CONS_FACT,
SEAL_PAST_CONS_PLAN_YEAR=:SEAL_PAST_CONS_PLAN_YEAR,
SEAL_PAST_CONS_PLAN_FACT=:SEAL_PAST_CONS_PLAN_FACT,
HYDROFLUID_CONS_PLAN_YEAR=:HYDROFLUID_CONS_PLAN_YEAR,
HYDROFLUID_CONS_FACT_YEAR=:HYDROFLUID_CONS_FACT_YEAR,
LEAK_DESCR=:LEAK_DESCR,
DATE_LEAK_DETECT=:DATE_LEAK_DETECT,
DATE_LEAK_FIX=:DATE_LEAK_FIX,
SHUTTER_TIGHT_DESCR=:SHUTTER_TIGHT_DESCR,
DATE_UNTIGHT_DETECT=:DATE_UNTIGHT_DETECT,
DATE_UNTIGHT_FIX=:DATE_UNTIGHT_FIX,
OPER_MANUF_ID=:OPER_MANUF_ID,
OPER_DATE_MANUF=:OPER_DATE_MANUF,
OPER_LABEL_TYPE_ID=:OPER_LABEL_TYPE_ID,
OPER_SERIAL_NUMBER=:OPER_SERIAL_NUMBER,
OPER_DATE_WORK_BEGIN=:OPER_DATE_WORK_BEGIN,
order_6_is=:ORDER_6_IS,
CONT_MEAS_2_IS=:CONT_MEAS_2_IS,
CONT_MEAS_3_IS=:CONT_MEAS_3_IS,
CONT_MEAS_4_IS=:CONT_MEAS_4_IS,
CONT_MEAS_5_IS=:CONT_MEAS_5_IS,
CONT_MEAS_6_IS=:CONT_MEAS_6_IS,
CONT_MEAS_7_IS=:CONT_MEAS_7_IS,
INFOTEH_IS=:INFOTEH_IS,
INFOTEH_CORRECTION=:INFOTEH_CORRECTION,
INFOTEH_COL_COR_LIST=:INFOTEH_COL_COR_LIST,
INFOTEH_COMMENT=:INFOTEH_COMMENT,
DATE_TO_LUBRICANT_PLAN=:DATE_TO_LUBRICANT_PLAN,
DATE_TO_LUBRICANT_FACT=:DATE_TO_LUBRICANT_FACT,
DATE_RSO=:DATE_RSO,
ADD_IS_1=:ADD_IS_1,
ADD_IS_2=:ADD_IS_2,
ADD_IS_3=:ADD_IS_3,
ADD_IS_4=:ADD_IS_4
 where id=:ID;
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VALVE"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
					DELETE FROM sutstpa.valve WHERE id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>


    <data table="VENT_PIPE" schema="SUTSTPA" id="SUTSTPA_СВЕЧА" comment="VENT_PIPE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
vent_pipe as (SELECT id, lpu, les, pipe, station,to_char(date_insp,'DD.MM.YYYY') date_insp, height_is, color_is, roof_is, pedestal_is, vert_is, lg_attach, operator1, operator2, operator3,operator4,operator5,operator6,struct_id,
abs(1-coalesce(height_is,1))*k_height_is+abs(1-coalesce(color_is,1))*k_color_is+abs(1-coalesce(roof_is,1))*k_roof_is+abs(1-coalesce(pedestal_is,1))*k_pedestal_is+abs(1-coalesce(vert_is,1))*k_vert_is rank
					FROM sutstpa.vent_pipe v,koef k)
                    SELECT id, lpu, les, pipe, station,date_insp, height_is, color_is, roof_is, pedestal_is, vert_is, lg_attach, operator1, operator2, operator3,operator4,operator5,operator6, rank,struct_id,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED'  
					end "TYPE" 
					FROM vent_pipe v, sum_koef sum_k where sum_k.check_table='sutstpa.vent_pipe' and {FILTER} 					
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VENT_PIPE"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
				<param name="LG_ATTACH" default="" type="String"/>
                <param name="LPU" default="" type="String"/>
                <param name="LES" default="" type="String"/>
                <param name="PIPE" default="" type="String"/>
                <param name="STATION" default="" type="Decimal" />
                <param name="DATE_INSP" default="" type="DateTime"/>
                <param name="HEIGHT_IS" default="" type="Decimal"/>
                <param name="COLOR_IS" default="" type="Decimal"/>
                <param name="ROOF_IS" default="" type="Decimal"/>
                <param name="PEDESTAL_IS" default="" type="Decimal"/>
                <param name="VERT_IS" default="" type="Decimal"/>
                <param name="LG_ATTACH" default="" type="String"/>
                <param name="OPERATOR1" default="" type="Decimal"/>
                <param name="OPERATOR2" default="" type="Decimal"/>
                <param name="OPERATOR3" default="" type="Decimal"/>
				<param name="OPERATOR4" default="" type="Decimal"/>
				<param name="OPERATOR5" default="" type="Decimal"/>
				<param name="OPERATOR6" default="" type="Decimal"/>
				<param name="STRUCT_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.vent_pipe"/>
                <query>
                    INSERT INTO sutstpa.vent_pipe
( lpu, les, pipe, station, date_insp, height_is, color_is, roof_is, pedestal_is, vert_is, lg_attach, operator1, operator2, operator3,operator4,operator5,operator6)
VALUES(
:LPU, 
:LES, 
:PIPE,  
:STATION, 
:DATE_INSP, 
:HEIGHT_IS, 
:COLOR_IS, 
:ROOF_IS, 
:PEDESTAL_IS, 
:VERT_IS, 
:LG_ATTACH,
:OPERATOR1, 
:OPERATOR2, 
:OPERATOR3,
:OPERATOR4,
:OPERATOR5,
:OPERATOR6)
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VENT_PIPE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
				<param name="LG_ATTACH" default="" type="String"/>
                <param name="LPU" default="" type="String"/>
                <param name="LES" default="" type="String"/>
                <param name="PIPE" default="" type="String"/>
                <param name="STATION" default="" type="Decimal" />
                <param name="DATE_INSP" default="" type="DateTime"/>
                <param name="HEIGHT_IS" default="" type="Decimal"/>
                <param name="COLOR_IS" default="" type="Decimal"/>
                <param name="ROOF_IS" default="" type="Decimal"/>
                <param name="PEDESTAL_IS" default="" type="Decimal"/>
                <param name="VERT_IS" default="" type="Decimal"/>
                <param name="LG_ATTACH" default="" type="String"/>
                <param name="OPERATOR1" default="" type="Decimal"/>
                <param name="OPERATOR2" default="" type="Decimal"/>
                <param name="OPERATOR3" default="" type="Decimal"/>
				<param name="OPERATOR4" default="" type="Decimal"/>
				<param name="OPERATOR5" default="" type="Decimal"/>
				<param name="OPERATOR6" default="" type="Decimal"/>
				<param name="STRUCT_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.vent_pipe
SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
HEIGHT_IS=:HEIGHT_IS,
COLOR_IS=:COLOR_IS,
ROOF_IS=:ROOF_IS,
PEDESTAL_IS=:PEDESTAL_IS,
VERT_IS=:VERT_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
STRUCT_ID=:STRUCT_ID
where id=:ID
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_VENT_PIPE"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.vent_pipe WHERE id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
    <data table="STRUCTURE" schema="SUTSTPA" id="SUTSTPA_КРАНОВЫЙ_УЗЕЛ" comment="STRUCTURE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>

with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table),
koef as (select (select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_4_IS') k_BARRIER_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_1_IS') k_ORDER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_4_IS') k_TERRITORY_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_1_IS') k_BARRIER_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_5_IS') k_ORDER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_6_IS') k_ORDER_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PLATE_IS') k_PLATE_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_7_IS') k_CONT_MEAS_7_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_2_IS') k_INF_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_3_IS') k_INF_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_5_IS') k_BARRIER_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_2_IS') k_SIGN_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_3_IS') k_SIGN_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_4_IS') k_SIGN_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_2_IS') k_ORDER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_5_IS') k_SIGN_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='SIGN_6_IS') k_SIGN_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_1_IS') k_TERRITORY_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_2_IS') k_TERRITORY_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TERRITORY_3_IS') k_TERRITORY_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_2_IS') k_BARRIER_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='BARRIER_3_IS') k_BARRIER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_3_IS') k_ORDER_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ORDER_4_IS') k_order_4_is,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ROOF_IS') k_ROOF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='HEIGHT_IS') k_HEIGHT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_IS') k_COLOR_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_2_IS') k_CONT_MEAS_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_3_IS') k_CONT_MEAS_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_4_IS') k_CONT_MEAS_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_6_IS') k_CONT_MEAS_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='CONT_MEAS_5_IS') k_CONT_MEAS_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_1_IS') k_EXT_CORR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_2_IS') k_EXT_CORR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='EXT_CORR_3_IS') k_EXT_CORR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_1_IS') k_GROUND_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_2_IS') k_GROUND_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_3_IS') k_GROUND_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_4_IS') k_GROUND_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='GROUND_5_IS') k_GROUND_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_3_IS') k_COLOR_3_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_1_IS') k_COLOR_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_2_IS') k_COLOR_2_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_4_IS') k_COLOR_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_5_IS') k_COLOR_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='COLOR_6_IS') k_COLOR_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_1_IS') k_INF_1_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_4_IS') k_INF_4_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_5_IS') k_INF_5_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_6_IS') k_INF_6_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_NOM_DIAM_IS') k_INF_NOM_DIAM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_PRES_IS') k_INF_PRES_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_DATE_MANUF_IS') k_INF_DATE_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='INF_MANUF_IS') k_INF_MANUF_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='TECH_NUM_IS') k_TECH_NUM_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='VERT_IS') k_VERT_IS,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_1') k_ADD_IS_1,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_2') k_ADD_IS_2,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_3') k_ADD_IS_3,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='ADD_IS_4') k_ADD_IS_4,
(select k.koeff from sutstpa.sprav_ntd_gcl k where k.check_column='PEDESTAL_IS') k_PEDESTAL_IS),
structure as (SELECT id, lpu, les, pipe, station,to_char(date_insp,'DD.MM.YYYY') date_insp, sign_2_is, sign_3_is, sign_4_is, sign_5_is, sign_6_is, territory_1_is, territory_2_is, territory_3_is, territory_4_is, 
barrier_1_is, barrier_2_is, barrier_3_is, barrier_4_is, barrier_5_is, order_1_is, order_2_is, order_3_is, order_4_is, order_5_is, cont_meas_8_is, lg_attach, operator1, operator2, operator3, operator4, operator5, 
operator6,to_char(date_rso_plan,'DD.MM.YYYY')  date_rso_plan,to_char(date_rso_fact,'DD.MM.YYYY')   date_rso_fact,add_pet_is_1, add_pet_is_2, add_pet_is_3, add_pet_is_4, corr_id,
abs(1-coalesce(sign_2_is,1))*k_sign_2_is+abs(1-coalesce(sign_3_is,1))*k_sign_3_is+abs(1-coalesce(sign_4_is,1))*k_sign_4_is+abs(1-coalesce(sign_5_is,1))*k_sign_5_is+abs(1-coalesce(sign_6_is,1))*k_sign_6_is
+coalesce(territory_1_is,0)*k_territory_1_is+coalesce(territory_2_is,0)*k_territory_2_is+coalesce(territory_3_is,0)*k_territory_3_is+coalesce(territory_4_is,0)*k_territory_4_is+abs(1-coalesce(barrier_1_is,1))*k_barrier_1_is
+abs(1-coalesce(barrier_2_is,1))*k_barrier_2_is+abs(1-coalesce(barrier_3_is,1))*k_barrier_3_is+abs(1-coalesce(barrier_4_is,1))*k_barrier_4_is+abs(1-coalesce(barrier_5_is,1))*k_barrier_5_is+coalesce(order_1_is,0)*k_order_1_is
+coalesce(order_2_is,0)*k_order_2_is+coalesce(order_3_is,0)*k_order_3_is+coalesce(order_5_is,0)*k_order_5_is+coalesce(order_4_is,0)*k_order_4_is rank
FROM sutstpa.structure s,koef k)
                    SELECT id, lpu, les, pipe, station, date_insp, sign_2_is, sign_3_is, sign_4_is, sign_5_is, sign_6_is, territory_1_is, territory_2_is, territory_3_is, territory_4_is, barrier_1_is, barrier_2_is, 
					barrier_3_is, barrier_4_is, barrier_5_is, order_1_is, order_2_is, order_3_is, order_4_is, order_5_is,
					cont_meas_8_is, lg_attach, operator1, operator2, operator3, operator4, operator5, operator6,rank,date_rso_plan,date_rso_fact,add_pet_is_1, add_pet_is_2, add_pet_is_3, add_pet_is_4, corr_id,
		   CASE when rank&lt;=sum_k.max_sum*0.15 then 'GREEN' 
           		when rank&gt;sum_k.max_sum*0.15 and rank&lt;=sum_k.max_sum*0.5 then 'YELLOW'
		 	when rank&gt;sum_k.max_sum*0.5 then 'RED'  
					end "TYPE" 
					FROM structure, sum_koef sum_k where sum_k.check_table='sutstpa.structure' and {FILTER} 
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_STRUCTURE"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="LG_ATTACH" default="" type="String"/>
                <param name="LPU" default="" type="String"/>
                <param name="LES" default="" type="String"/>
                <param name="PIPE" default="" type="String"/>
                <param name="STATION" default="" type="Decimal"/>
                <param name="DATE_INSP" default="" type="DateTime"/>
                <param name="SIGN_1_IS" default="" type="Decimal"/>
                <param name="SIGN_2_IS" default="" type="Decimal"/>
                <param name="SIGN_3_IS" default="" type="Decimal"/>
                <param name="SIGN_4_IS" default="" type="Decimal"/>
                <param name="SIGN_5_IS" default="" type="Decimal"/>
                <param name="SIGN_6_IS" default="" type="Decimal"/>
                <param name="TERRITORY_1_IS" default="" type="Decimal"/>
                <param name="TERRITORY_2_IS" default="" type="Decimal"/>
                <param name="TERRITORY_3_IS" default="" type="Decimal"/>
                <param name="TERRITORY_4_IS" default="" type="Decimal"/>
                <param name="BARRIER_1_IS" default="" type="Decimal"/>
                <param name="BARRIER_2_IS" default="" type="Decimal"/>
                <param name="BARRIER_3_IS" default="" type="Decimal"/>
                <param name="BARRIER_4_IS" default="" type="Decimal"/>
                <param name="BARRIER_5_IS" default="" type="Decimal"/>
                <param name="ORDER_1_IS" default="" type="Decimal"/>
                <param name="ORDER_2_IS" default="" type="Decimal"/>
                <param name="ORDER_3_IS" default="" type="Decimal"/>
                <param name="ORDER_6_IS" default="" type="Decimal"/>
                <param name="ORDER_5_IS" default="" type="Decimal"/>
                <param name="ORDER_4_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_1_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_2_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_3_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_4_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_5_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_6_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_7_IS" default="" type="Decimal"/>
                <param name="CONT_MEAS_8_IS" default="" type="Decimal"/>
                <param name="OPERATOR1" default="" type="Decimal"/>
                <param name="OPERATOR2" default="" type="Decimal"/>
                <param name="OPERATOR3" default="" type="Decimal"/>
				<param name="OPERATOR4" default="" type="Decimal"/>
				<param name="OPERATOR5" default="" type="Decimal"/>
				<param name="OPERATOR6" default="" type="Decimal"/>
				<param name="DATE_RSO_PLAN" default="" type="String"/>
				<param name="DATE_RSO_FACT" default="" type="String"/>
				<param name="ADD_PET_IS_1" default="" type="Decimal"/>
				<param name="ADD_PET_IS_2" default="" type="Decimal"/>
				<param name="ADD_PET_IS_3" default="" type="Decimal"/>
				<param name="ADD_PET_IS_4" default="" type="Decimal"/>
				<param name="CORR_ID" default="" type="String"/>

                <var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.structure"/>
                <query>
                    INSERT INTO sutstpa.structure
    (
	lpu, 
	les, 
	pipe, 
	station, 
	date_insp, 
	sign_2_is, 
	sign_3_is,
	sign_4_is, 
	sign_5_is, 
	sign_6_is, 
	territory_1_is, 
	territory_2_is, 
	territory_3_is, 
	territory_4_is, 
	barrier_1_is, 
	barrier_2_is, 
	barrier_3_is, 
	barrier_4_is, 
	barrier_5_is, 
	order_1_is, 
	order_2_is, 
	order_3_is, 
	order_4_is, 
	order_5_is, 
 cont_meas_8_is, 
 lg_attach, 
 operator1, 
 operator2, 
 operator3,
 operator4,
 operator5,
 operator6,
 date_rso_plan,
 date_rso_fact,
 add_pet_is_1,
 add_pet_is_2,
 add_pet_is_3,
 add_pet_is_4,
 corr_id
)
    VALUES( :LPU, 
:LES, 
:PIPE, 
:STATION, 
:DATE_INSP, 
:SIGN_2_IS, 
:SIGN_3_IS,
:SIGN_4_IS, 
:SIGN_5_IS, 
:SIGN_6_IS, 
:TERRITORY_1_IS, 
:TERRITORY_2_IS, 
:TERRITORY_3_IS, 
:TERRITORY_4_IS, 
:BARRIER_1_IS, 
:BARRIER_2_IS, 
:BARRIER_3_IS, 
:BARRIER_4_IS, 
:BARRIER_5_IS, 
:ORDER_1_IS, 
:ORDER_2_IS, 
:ORDER_3_IS, 
:ORDER_4_IS, 
:ORDER_5_IS, 
:CONT_MEAS_8_IS, 
:LG_ATTACH, 
:OPERATOR1, 
:OPERATOR2, 
:OPERATOR3,
:OPERATOR4,
:OPERATOR5,
:OPERATOR6,
:DATE_RSO_PLAN,
:DATE_RSO_FACT,
:ADD_PET_IS_1,
:ADD_PET_IS_2,
:ADD_PET_IS_3,
:ADD_PET_IS_4,
:CORR_ID
)
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_STRUCTURE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
<param name="TYPE_RANGE" default="" type="String"/>
<param name="LG_ATTACH" default="" type="String"/>
                <param name="LPU" default="" type="String"/>
                <param name="LES" default="" type="String"/>
                <param name="PIPE" default="" type="String"/>
                <param name="STATION" default="" type="Decimal"/>
                <param name="DATE_INSP" default="" type="DateTime"/>
                <param name="SIGN_1_IS" default="" type="String"/>
                <param name="SIGN_2_IS" default="" type="String"/>
                <param name="SIGN_3_IS" default="" type="String"/>
                <param name="SIGN_4_IS" default="" type="String"/>
                <param name="SIGN_5_IS" default="" type="String"/>
                <param name="SIGN_6_IS" default="" type="String"/>
                <param name="TERRITORY_1_IS" default="" type="String"/>
                <param name="TERRITORY_2_IS" default="" type="String"/>
                <param name="TERRITORY_3_IS" default="" type="String"/>
                <param name="TERRITORY_4_IS" default="" type="String"/>
                <param name="BARRIER_1_IS" default="" type="String"/>
                <param name="BARRIER_2_IS" default="" type="String"/>
                <param name="BARRIER_3_IS" default="" type="String"/>
                <param name="BARRIER_4_IS" default="" type="String"/>
                <param name="BARRIER_5_IS" default="" type="String"/>
                <param name="ORDER_1_IS" default="" type="String"/>
                <param name="ORDER_2_IS" default="" type="String"/>
                <param name="ORDER_3_IS" default="" type="String"/>
                <param name="ORDER_6_IS" default="" type="String"/>
                <param name="ORDER_5_IS" default="" type="String"/>
                <param name="ORDER_4_IS" default="" type="String"/>
                <param name="CONT_MEAS_1_IS" default="" type="String"/>
                <param name="CONT_MEAS_2_IS" default="" type="String"/>
                <param name="CONT_MEAS_3_IS" default="" type="String"/>
                <param name="CONT_MEAS_4_IS" default="" type="String"/>
                <param name="CONT_MEAS_5_IS" default="" type="String"/>
                <param name="CONT_MEAS_6_IS" default="" type="String"/>
                <param name="CONT_MEAS_7_IS" default="" type="String"/>
                <param name="CONT_MEAS_8_IS" default="" type="String"/>
                <param name="OPERATOR1" default="" type="String"/>
                <param name="OPERATOR2" default="" type="String"/>
                <param name="OPERATOR3" default="" type="String"/>
		<param name="OPERATOR4" default="" type="String"/>
		<param name="OPERATOR5" default="" type="String"/>
		<param name="OPERATOR6" default="" type="String"/>
		<param name="DATE_RSO_PLAN" default="" type="DateTime"/>
		<param name="DATE_RSO_FACT" default="" type="DateTime"/>
		<param name="ADD_PET_IS_1" default="" type="Decimal"/>
		<param name="ADD_PET_IS_2" default="" type="Decimal"/>
		<param name="ADD_PET_IS_3" default="" type="Decimal"/>
		<param name="ADD_PET_IS_4" default="" type="Decimal"/>
		<param name="CORR_ID" default="" type="String"/>
        <var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.structure"/>
                <query>
                    UPDATE sutstpa.structure
SET 
LPU=:LPU,
LES=:LES,
PIPE=:PIPE,
STATION=:STATION,
SIGN_2_IS=:SIGN_2_IS,
SIGN_3_IS=:SIGN_3_IS,
SIGN_4_IS=:SIGN_4_IS,
SIGN_5_IS=:SIGN_5_IS,
SIGN_6_IS=:SIGN_6_IS,
TERRITORY_1_IS=:TERRITORY_1_IS,
TERRITORY_2_IS=:TERRITORY_2_IS,
TERRITORY_3_IS=:TERRITORY_3_IS,
TERRITORY_4_IS=:TERRITORY_4_IS,
BARRIER_1_IS=:BARRIER_1_IS,
BARRIER_2_IS=:BARRIER_2_IS,
BARRIER_3_IS=:BARRIER_3_IS,
BARRIER_4_IS=:BARRIER_4_IS,
BARRIER_5_IS=:BARRIER_5_IS,
ORDER_1_IS=:ORDER_1_IS,
ORDER_2_IS=:ORDER_2_IS,
ORDER_3_IS=:ORDER_3_IS,
ORDER_5_IS=:ORDER_5_IS,
ORDER_4_IS=:ORDER_4_IS,
CONT_MEAS_8_IS=:CONT_MEAS_8_IS,
OPERATOR1=:OPERATOR1,
OPERATOR2=:OPERATOR2,
OPERATOR3=:OPERATOR3,
OPERATOR4=:OPERATOR4,
OPERATOR5=:OPERATOR5,
OPERATOR6=:OPERATOR6,
DATE_INSP=:DATE_INSP,
DATE_RSO_PLAN=:DATE_RSO_PLAN,
DATE_RSO_FACT=:DATE_RSO_FACT,
TYPE_RANGE=:TYPE_RANGE,
ADD_PET_IS_1=:ADD_PET_IS_1,
ADD_PET_IS_2=:ADD_PET_IS_2,
ADD_PET_IS_3=:ADD_PET_IS_3,
ADD_PET_IS_4=:ADD_PET_IS_4,
CORR_ID=:CORR_ID
where id=:ID;
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_STRUCTURE"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.structure WHERE id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
	 <data table="SPRAV_NTD_GCL" schema="SUTSTPA" id="RANK_LEGEND" comment="SPRAV_NTD_GCL">
        <select>
            <dbQuery idField="ID">
                <var name="TABLE_NAME" default="VALVE"/>
                <query>
with sum_koef as (select n.check_table,sum(n.koeff) max_sum from sutstpa.sprav_ntd_gcl n where n.check_table is not null group by n.check_table)
   select upper(replace(check_table,'sutstpa.','')) table_name, max_sum*0.15 perc_15, max_sum*0.50 perc_50 from sum_koef where upper(replace(check_table,'sutstpa.','')) = upper('{TABLE_NAME}')
	                </query>
            </dbQuery>
        </select>
	</data>
		 <data table="INFOTEH_LIST" schema="SUTSTPA" id="MISMATCH_INFOTEH" comment="Список вкладки сверки с Инфотехом для папорта кранов">
        <select>
            <dbQuery idField="ID">
                <var name="ID" default="-1"/>
                <query>
with sprav_col as (select 'CLIMATIC_TYPE_ID' col_name, 'Климатическое исполнение крана' col_descr union all
select 'DATE_INSTALL' col_name, 'Дата врезки' col_descr union all
select 'DATE_MANUF' col_name, 'Дата изготовления' col_descr union all
select 'ELECTRIC_DRIVE_DESCR' col_name, 'Готовность крана к телемеханизации' col_descr union all
select 'DATE_WORK_BEGIN' col_name, 'Дата ввода в эксплуатацию ТПА' col_descr union all
select 'INSTALL_TYPE_ID' col_name, 'Тип  установки' col_descr union all
select 'INVENT_NUMBER' col_name, 'Инв. номер ТПА' col_descr union all
select 'JOINT_ID' col_name, 'Тип присоединения' col_descr union all
select 'LIFETIME' col_name, 'Нормативный срок службы' col_descr union all
select 'MANUF_ID' col_name, 'Изготовитель ТПА' col_descr union all
select 'NAME_ID' col_name, 'Наименование ТПА' col_descr union all
select 'NOM_DIAM_ID' col_name, 'Номинальный диаметр DN' col_descr union all
select 'NOM_PRESS_ID' col_name, 'Номинальное давление PN' col_descr union all
select 'OPER_DATE_WORK_BEGIN' col_name, 'Год ввода в эксплуатацию привода' col_descr union all
select 'OPER_LABEL_TYPE_ID' col_name, 'Маркировка привода' col_descr union all
select 'OPER_MANUF_ID' col_name, 'Изготовитель привода' col_descr union all
select 'PASSPORT_DOCUMENT_DESCR' col_name, 'Наличие паспорта крана' col_descr union all
select 'SERIAL_NUM' col_name, 'Заводской номер' col_descr union all
select 'TECH_NUM' col_name, 'Технологический номер' col_descr union all
select 'WORK_PRESSURE_FACT' col_name, 'Фактическое рабочее давление' col_descr union all
select 'WORK_TEMP_FACT' col_name, 'Фактическая рабочая температура' col_descr union all
select 'WORK_TEMP_PROJECT' col_name, 'Проектная  рабочая температура' col_descr union all
select 'TYPE_ID' col_name, 'Тип крана' col_descr union all
select 'OPER_TYPE_ID' col_name, 'Тип привода' col_descr union all
select 'MATERIAL_ID' col_name, 'Материал изготовления корпуса' col_descr union all
select 'TPA_FIGURE_TYPE_ID' col_name, 'Маркировка ТПА по табл. фигур' col_descr union all
select 'TPA_CONSTR_TYPE_ID' col_name, 'Маркировка ТПА(по конструкт. докум.)' col_descr union all
select 'OPER_DATE_MANUF' col_name, 'Дата изготовления привода' col_descr union all
select 'OPER_SERIAL_NUMBER' col_name, 'Заводской номер привода' col_descr union all
select 'DESCR' col_name, 'Маркировка' col_descr union all
select 'DATE_EXP' col_name, 'Дата\nистеч.срока\nэксплуатации' col_descr),
valve_data as (select 'CLIMATIC_TYPE_ID' col_name, CLIMATIC_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_INSTALL' col_name, to_char(DATE_INSTALL,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_MANUF' col_name, to_char(DATE_MANUF,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'ELECTRIC_DRIVE_DESCR' col_name, ELECTRIC_DRIVE_DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_WORK_BEGIN' col_name, to_char(DATE_WORK_BEGIN,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'INSTALL_TYPE_ID' col_name, INSTALL_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'INVENT_NUMBER' col_name, INVENT_NUMBER::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'JOINT_ID' col_name, JOINT_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'LIFETIME' col_name, LIFETIME::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'MANUF_ID' col_name, MANUF_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NAME_ID' col_name, NAME_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NOM_DIAM_ID' col_name, NOM_DIAM_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NOM_PRESS_ID' col_name, NOM_PRESS_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_DATE_WORK_BEGIN' col_name, to_char(OPER_DATE_WORK_BEGIN,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_LABEL_TYPE_ID' col_name, OPER_LABEL_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_MANUF_ID' col_name, OPER_MANUF_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'PASSPORT_DOCUMENT_DESCR' col_name, PASSPORT_DOCUMENT_DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'SERIAL_NUM' col_name, SERIAL_NUM::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TECH_NUM' col_name, TECH_NUM::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_PRESSURE_FACT' col_name, WORK_PRESSURE_FACT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_TEMP_FACT' col_name, WORK_TEMP_FACT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_TEMP_PROJECT' col_name, WORK_TEMP_PROJECT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TYPE_ID' col_name, TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_TYPE_ID' col_name, OPER_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'MATERIAL_ID' col_name, MATERIAL_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TPA_FIGURE_TYPE_ID' col_name, TPA_FIGURE_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TPA_CONSTR_TYPE_ID' col_name, TPA_CONSTR_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_DATE_MANUF' col_name, to_char(OPER_DATE_MANUF,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_SERIAL_NUMBER' col_name, OPER_SERIAL_NUMBER::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DESCR' col_name, DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_EXP' col_name, to_char(DATE_EXP,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID})
select m.mismatch_id id /*Идентификатор - по умолчанию скрыт*/, col.col_descr column_name/*Название характеристики*/,m.column_value /*неверное начение*/, v.col_descr, /*верное значение*/
m.action_id /*Что делать*/,m.person_id/*Ответственный*/ from sutstpa.mismatch_infoteh m, sprav_col col, valve_data v where v.col_name=m.column_name and col.col_name=m.column_name  and m.valve_id={ID}
 and (m.column_value is not null and v.col_descr is not null)
	                </query>
            </dbQuery>
        </select>
	</data>
	<data table="EXEC_DOC_LIST" schema="SUTSTPA" id="MISMATCH_EXEC_DOC" comment="Список вкладки сверки с исп. документаций для паспорта кранов">
        <select>
            <dbQuery idField="ID">
                <var name="ID" default="-1"/>
                <query>
with doc_file as (select v.file_name from web50.lib_doc d,web50.lib_doc_version v,web50.lnk_gate g where g.left_obj_id='WEB50_LIB_DOC/'||d.doc_id and  d.doc_id=v.doc_id and g.right_obj_id='SUTSTPA_КРАН/'||{ID} and d.parent_doc_id=160600 limit 1),
sprav_col as (select 'CLIMATIC_TYPE_ID' col_name, 'Климатическое исполнение крана' col_descr union all
select 'DATE_INSTALL' col_name, 'Дата врезки' col_descr union all
select 'DATE_MANUF' col_name, 'Дата изготовления' col_descr union all
select 'ELECTRIC_DRIVE_DESCR' col_name, 'Готовность крана к телемеханизации' col_descr union all
select 'DATE_WORK_BEGIN' col_name, 'Дата ввода в эксплуатацию ТПА' col_descr union all
select 'INSTALL_TYPE_ID' col_name, 'Тип  установки' col_descr union all
select 'INVENT_NUMBER' col_name, 'Инв. номер ТПА' col_descr union all
select 'JOINT_ID' col_name, 'Тип присоединения' col_descr union all
select 'LIFETIME' col_name, 'Нормативный срок службы' col_descr union all
select 'MANUF_ID' col_name, 'Изготовитель ТПА' col_descr union all
select 'NAME_ID' col_name, 'Наименование ТПА' col_descr union all
select 'NOM_DIAM_ID' col_name, 'Номинальный диаметр DN' col_descr union all
select 'NOM_PRESS_ID' col_name, 'Номинальное давление PN' col_descr union all
select 'OPER_DATE_WORK_BEGIN' col_name, 'Год ввода в эксплуатацию привода' col_descr union all
select 'OPER_LABEL_TYPE_ID' col_name, 'Маркировка привода' col_descr union all
select 'OPER_MANUF_ID' col_name, 'Изготовитель привода' col_descr union all
select 'PASSPORT_DOCUMENT_DESCR' col_name, 'Наличие паспорта крана' col_descr union all
select 'SERIAL_NUM' col_name, 'Заводской номер' col_descr union all
select 'TECH_NUM' col_name, 'Технологический номер' col_descr union all
select 'WORK_PRESSURE_FACT' col_name, 'Фактическое рабочее давление' col_descr union all
select 'WORK_TEMP_FACT' col_name, 'Фактическая рабочая температура' col_descr union all
select 'WORK_TEMP_PROJECT' col_name, 'Проектная  рабочая температура' col_descr union all
select 'TYPE_ID' col_name, 'Тип крана' col_descr union all
select 'OPER_TYPE_ID' col_name, 'Тип привода' col_descr union all
select 'MATERIAL_ID' col_name, 'Материал изготовления корпуса' col_descr union all
select 'TPA_FIGURE_TYPE_ID' col_name, 'Маркировка ТПА по табл. фигур' col_descr union all
select 'TPA_CONSTR_TYPE_ID' col_name, 'Маркировка ТПА(по конструкт. докум.)' col_descr union all
select 'OPER_DATE_MANUF' col_name, 'Дата изготовления привода' col_descr union all
select 'OPER_SERIAL_NUMBER' col_name, 'Заводской номер привода' col_descr union all
select 'DESCR' col_name, 'Маркировка' col_descr union all
select 'DATE_EXP' col_name, 'Дата\nистеч.срока\nэксплуатации' col_descr),
valve_data as (select 'CLIMATIC_TYPE_ID' col_name, CLIMATIC_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_INSTALL' col_name, to_char(DATE_INSTALL,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_MANUF' col_name,    to_char(DATE_MANUF,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'ELECTRIC_DRIVE_DESCR' col_name, ELECTRIC_DRIVE_DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_WORK_BEGIN' col_name, to_char(DATE_WORK_BEGIN,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'INSTALL_TYPE_ID' col_name, INSTALL_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'INVENT_NUMBER' col_name, INVENT_NUMBER::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'JOINT_ID' col_name, JOINT_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'LIFETIME' col_name, LIFETIME::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'MANUF_ID' col_name, MANUF_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NAME_ID' col_name, NAME_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NOM_DIAM_ID' col_name, NOM_DIAM_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'NOM_PRESS_ID' col_name, NOM_PRESS_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_DATE_WORK_BEGIN' col_name, to_char(OPER_DATE_WORK_BEGIN,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_LABEL_TYPE_ID' col_name, OPER_LABEL_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_MANUF_ID' col_name, OPER_MANUF_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'PASSPORT_DOCUMENT_DESCR' col_name, PASSPORT_DOCUMENT_DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'SERIAL_NUM' col_name, SERIAL_NUM::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TECH_NUM' col_name, TECH_NUM::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_PRESSURE_FACT' col_name, WORK_PRESSURE_FACT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_TEMP_FACT' col_name, WORK_TEMP_FACT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'WORK_TEMP_PROJECT' col_name, WORK_TEMP_PROJECT::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TYPE_ID' col_name, TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_TYPE_ID' col_name, OPER_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'MATERIAL_ID' col_name, MATERIAL_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TPA_FIGURE_TYPE_ID' col_name, TPA_FIGURE_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'TPA_CONSTR_TYPE_ID' col_name, TPA_CONSTR_TYPE_ID::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_DATE_MANUF' col_name, to_char(OPER_DATE_MANUF,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID} union all
select 'OPER_SERIAL_NUMBER' col_name, OPER_SERIAL_NUMBER::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DESCR' col_name, DESCR::text col_descr from sutstpa.valve v where v.id={ID} union all
select 'DATE_EXP' col_name, to_char(DATE_EXP,'DD.MM.YYYY') col_descr from sutstpa.valve v where v.id={ID})
select m.mismatch_id id /*Идентификатор - по умолчанию скрыт*/, col.col_descr column_name/*Название характеристики*/,m.column_value /*неверное начение*/, v.col_descr, /*верное значение*/
m.action_id /*Что делать*/,m.person_id/*Ответственный*/,dd.file_name from sprav_col col, valve_data v,sutstpa.mismatch_exec_doc m
left join doc_file dd on 1=1
                    where  v.col_name=m.column_name and col.col_name=m.column_name  and m.valve_id={ID}
	                </query>
            </dbQuery>
        </select>
	</data>
 <data table="SERVICE_MAINTENANCE" schema="SUTSTPA" id="SUTSTPA_SERVICE_MAINTENANCE" comment="SERVICE_MAINTENANCE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT maint_id ID, t.* FROM sutstpa.service_maintenance t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_MAINTENANCE"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="LUBRICANT_VALUE_FACT" default="" type="Decimal"/>
                <var name="HYDROFLUID_VALUE_FACT" default="" type="Decimal"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
				<var name="RESULT_1_CL" default="" type="String"/>
				<var name="RESULT_2_CL" default="" type="String"/>
				<var name="CORRECTION_CL" default="" type="String"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(maint_id) id FROM sutstpa.service_maintenance"/>
                <query>
                    INSERT INTO sutstpa.service_maintenance
					(valve_id, date_plan, date_fact, type_cl, "result", description, lubricant_value_fact, hydrofluid_value_fact, person_id, notif_id,RESULT_1_CL, RESULT_2_CL, CORRECTION_CL)
					VALUES({VALVE_ID}, '{DATE_PLAN}', '{DATE_FACT}', '{TYPE_CL}', '{RESULT}', '{DESCRIPTION}', {LUBRICANT_VALUE_FACT}, {HYDROFLUID_VALUE_FACT}, {PERSON_ID}, {NOTIF_ID},'{RESULT_1_CL}', '{RESULT_2_CL}', '{CORRECTION_CL}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_MAINTENANCE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="LUBRICANT_VALUE_FACT" default="" type="Decimal"/>
                <var name="HYDROFLUID_VALUE_FACT" default="" type="Decimal"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
				<var name="RESULT_1_CL" default="" type="String"/>
				<var name="RESULT_2_CL" default="" type="String"/>
				<var name="CORRECTION_CL" default="" type="String"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.service_maintenance
					SET valve_id={VALVE_ID}, date_plan='{DATE_PLAN}', date_fact='{DATE_FACT}', type_cl='{TYPE_CL}', "result"='{RESULT}', description='{DESCRIPTION}', lubricant_value_fact={LUBRICANT_VALUE_FACT}, 
					hydrofluid_value_fact={HYDROFLUID_VALUE_FACT}, person_id={PERSON_ID}, notif_id={NOTIF_ID},RESULT_1_CL='{RESULT_1_CL}', RESULT_2_CL='{RESULT_2_CL}',CORRECTION_CL='{CORRECTION_CL}'
					WHERE maint_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_MAINTENANCE"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.service_maintenance
                    WHERE maint_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>	
    <data table="SERVICE_EPB" schema="SUTSTPA" id="SUTSTPA_SERVICE_EPB" comment="SERVICE_EPB">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT epb_id ID, t.* FROM sutstpa.service_epb t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_EPB"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(epb_id) id FROM sutstpa.service_epb"/>
                <query>
                    INSERT INTO sutstpa.service_epb
					(valve_id, date_plan, date_fact, type_cl, "result", description, person_id, notif_id)
					VALUES({VALVE_ID}, '{DATE_PLAN}', '{DATE_FACT}', '{TYPE_CL}', '{RESULT}', '{DESCRIPTION}', {PERSON_ID}, {NOTIF_ID})
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_EPB"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.service_epb
					SET valve_id={VALVE_ID}, date_plan='{DATE_PLAN}', date_fact='{DATE_FACT}', type_cl='{TYPE_CL}', "result"='{RESULT}', description='{DESCRIPTION}', person_id={PERSON_ID}, notif_id={NOTIF_ID}
					WHERE epb_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_EPB"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.service_epb
					WHERE epb_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>	
    <data table="SERVICE_COND_VIOL" schema="SUTSTPA" id="SUTSTPA_SERVICE_COND_VIOL" comment="SERVICE_COND_VIOL">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT cond_viol_id ID, t.* FROM sutstpa.service_cond_viol t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_COND_VIOL"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var  name="DATE_DETECT" default="" type="DateTime"/>
                <var  name="DATE_FIX" default="" type="DateTime"/>
                <var  name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"  direction="Output" default="SELECT max(cond_viol_id) id FROM sutstpa.service_cond_viol"/>
                <query>
                    INSERT INTO sutstpa.service_cond_viol
					(valve_id, date_detect, date_fix, type_cl, "result", description, person_id, notif_id)
					VALUES({VALVE_ID}, '{DATE_DETECT}', '{DATE_FIX}', '{TYPE_CL}', '{RESULT}', '{DESCRIPTION}', {PERSON_ID}, {NOTIF_ID})
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_COND_VIOL"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_DETECT" default="" type="DateTime"/>
                <var name="DATE_FIX" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.service_cond_viol
					SET valve_id={VALVE_ID}, date_detect='{DATE_DETECT}', date_fix='{DATE_FIX}', type_cl='{TYPE_CL}', "result"='{RESULT}', description='{DESCRIPTION}', person_id={PERSON_ID}, notif_id={NOTIF_ID}
					WHERE cond_viol_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_COND_VIOL"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.service_cond_viol
					WHERE cond_viol_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>	
    <data table="SERVICE_REPAIR" schema="SUTSTPA" id="SUTSTPA_SERVICE_REPAIR" comment="SERVICE_REPAIR">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT repair_id ID, t.* FROM sutstpa.service_repair t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_REPAIR"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
			    <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(repair_id) id FROM sutstpa.service_repair"/>
                <query>
                    INSERT INTO sutstpa.service_repair
					(valve_id, date_plan, date_fact, type_cl, "result", description, serial_number_repair, person_id, notif_id)
					VALUES({VALVE_ID}, '{DATE_PLAN}', '{DATE_FACT}', '{TYPE_CL}', '{RESULT}', '{DESCRIPTION}', '{SERIAL_NUMBER_REPAIR}', {PERSON_ID}, {NOTIF_ID})
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_REPAIR"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
			    <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DATE_PLAN" default="" type="DateTime"/>
                <var name="DATE_FACT" default="" type="DateTime"/>
                <var name="TYPE_CL" default="" type="String"/>
                <var name="RESULT" default="" type="String"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="SERIAL_NUMBER_REPAIR" default="" type="String"/>
                <var name="PERSON_ID" default="" type="Decimal"/>
                <var name="NOTIF_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.service_repair
					SET valve_id={VALVE_ID}, date_plan='{DATE_PLAN}', date_fact='{DATE_FACT}', type_cl='{TYPE_CL}', "result"='{RESULT}', description='{DESCRIPTION}', serial_number_repair='{SERIAL_NUMBER_REPAIR}', person_id={PERSON_ID}, notif_id={NOTIF_ID}
					WHERE repair_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_SERVICE_REPAIR"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.service_repair
					WHERE repair_id={ID}
                </query>
            </dbCommand>
        </delete>
    </data>
    <data table="MISMATCH_EXEC_DOC_FORMAT" schema="SUTSTPA" id="SUTSTPA_MISMATCH_EXEC_DOC_FORMAT" comment="MISMATCH_EXEC_DOC_FORMAT">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT VALVE_ID ID, t.* FROM sutstpa.mismatch_exec_doc_format t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC_FORMAT"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
			    <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <query>
                    INSERT INTO sutstpa.mismatch_exec_doc_format
					(valve_id, description)
					VALUES({VALVE_ID}, '{DESCRIPTION}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC_FORMAT"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="VALVE_ID" type="Decimal"/>
				<var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.mismatch_exec_doc_format
					SET valve_id={VALVE_ID}, description='{DESCRIPTION}' where valve_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC_FORMAT"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Decimal" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.mismatch_exec_doc_format
					WHERE valve_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
    <data table="MISMATCH_EXEC_DOC" schema="SUTSTPA" id="SUTSTPA_MISMATCH_EXEC_DOC" comment="MISMATCH_EXEC_DOC">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT mismatch_id ID, t.* FROM sutstpa.mismatch_exec_doc t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
			  <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="COLUMN_NAME" default="" type="String"/>
                <var name="COLUMN_VALUE" default="" type="String"/>
                <var name="ACTION_ID" default="" type="String"/>
                <ram name="PERSON_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(mismatch_id) id FROM sutstpa.mismatch_exec_doc"/>
                <query>
                    INSERT INTO sutstpa.mismatch_exec_doc
					(valve_id, column_name, column_value, action_id, person_id)
					VALUES({VALVE_ID}, '{COLUMN_NAME}', '{COLUMN_VALUE}', '{ACTION_ID}', {PERSON_ID})
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
			  <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="COLUMN_NAME" default="" type="String"/>
                <var name="COLUMN_VALUE" default="" type="String"/>
                <var name="ACTION_ID" default="" type="String"/>
                <ram name="PERSON_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.mismatch_exec_doc
					SET valve_id={VALVE_ID}, column_name='{COLUMN_NAME}', column_value='{COLUMN_VALUE}', action_id='{ACTION_ID}', person_id={PERSON_ID}
					WHERE mismatch_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_EXEC_DOC"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.mismatch_exec_doc
					WHERE mismatch_id=:ID
				 </query>
            </dbCommand>
        </delete>
    </data>
    <data table="MISMATCH_INFOTEH" schema="SUTSTPA" id="SUTSTPA_MISMATCH_INFOTEH" comment="MISMATCH_INFOTEH">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT mismatch_id ID, t.* FROM sutstpa.mismatch_infoteh t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INFOTEH"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
			  <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="COLUMN_NAME" default="" type="String"/>
                <var name="COLUMN_VALUE" default="" type="String"/>
                <var name="ACTION_ID" default="" type="String"/>
                <ram name="PERSON_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(mismatch_id) id FROM sutstpa.mismatch_infoteh"/>
                <query>
                    INSERT INTO sutstpa.mismatch_infoteh
					(valve_id, column_name, column_value, action_id, person_id)
					VALUES({VALVE_ID}, '{COLUMN_NAME}', '{COLUMN_VALUE}', '{ACTION_ID}', {PERSON_ID})
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INFOTEH"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
			  <var name="VALVE_ID" default="" type="Decimal"/>
                <var name="COLUMN_NAME" default="" type="String"/>
                <var name="COLUMN_VALUE" default="" type="String"/>
                <var name="ACTION_ID" default="" type="String"/>
                <ram name="PERSON_ID" default="" type="Decimal"/>
                <var name="ID" type="Int64" direction="Output"/>
                <query>
                    UPDATE sutstpa.mismatch_infoteh
					SET valve_id={VALVE_ID}, column_name='{COLUMN_NAME}', column_value='{COLUMN_VALUE}', action_id='{ACTION_ID}', person_id={PERSON_ID}
					WHERE mismatch_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INFOTEH"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.mismatch_infoteh
					WHERE mismatch_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
    <data table="NOTIF_MESSAGE" schema="SUTSTPA" id="SUTSTPA_NOTIF_MESSAGE" comment="NOTIF_MESSAGE">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
 SELECT * FROM (SELECT message_id ID, t.* FROM sutstpa.notif_message t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
		<insert>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_MESSAGE"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="TABLE_NAME" default="" type="String"/>
                <var name="BODY" default="" type="String"/>
                <var name="TEMPLATE_SQL" default="" type="String"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(message_id) id FROM sutstpa.notif_message"/>
                <query>
                    INSERT INTO sutstpa.notif_message
					(description, table_name, body, template_sql)
					VALUES('{DESCRIPTION}','{TABLE_NAME}', '{BODY}', '{TEMPLATE_SQL}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
			<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_MESSAGE"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
                <var name="DESCRIPTION" default="" type="String"/>
                <var name="TABLE_NAME" default="" type="String"/>
                <var name="BODY" default="" type="String"/>
                <var name="TEMPLATE_SQL" default="" type="String"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.notif_message
					SET description='{DESCRIPTION}', table_name='{TABLE_NAME}', body='{BODY}', template_sql='{TEMPLATE_SQL}' WHERE message_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
						<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_MESSAGE"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.notif_message WHERE message_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
    <data table="NOTIF_PERSON" schema="SUTSTPA" id="SUTSTPA_NOTIF_PERSON" comment="NOTIF_PERSON">
        <select>
            <dbQuery idField="ID">
                <param name="USER_ID" default="-1" type="Int64"/>
                <var name="FILTER" default="1=1"/>
                <query>
SELECT * FROM (SELECT person_id ID, t.* FROM sutstpa.notif_person t) d WHERE {FILTER}
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
						<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_PERSON"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
            	<var name="USER_ID" default="" type="Decimal"/>
                <var name="NAME" default="" type="String"/>
                <var name="LAST_NAME" default="" type="String"/>
                <var name="POSITION" default="" type="String"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(person_id) id FROM sutstpa.notif_person"/>
                <query>
                    INSERT INTO sutstpa.notif_person
					(user_id, "name", last_name, "position")
					VALUES({USER_ID}, '{NAME}', '{LAST_NAME}', '{POSITION}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
						<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_PERSON"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
               <var name="USER_ID" default="" type="Decimal"/>
                <var name="NAME" default="" type="String"/>
                <var name="LAST_NAME" default="" type="String"/>
                <var name="POSITION" default="" type="String"/>
                <var name="ID" type="Int64"/>
                <query>
                    UPDATE sutstpa.notif_person
					SET user_id={USER_ID}, "name"='{NAME}', last_name='{LAST_NAME}', "position"='{POSITION}'	WHERE person_id={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
						<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_NOTIF_PERSON"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.notif_person WHERE person_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>
	
	 <data table="MISMATCH_EXEC_DATA" schema="SUTSTPA" id="SUTSTPA_MISMATCH_EXEC_DATA" comment="MISMATCH_EXEC_DATA">
        <select>
            <dbQuery idField="ID">
                <var name="FILTER" default="1=1"/>
                <query>
				SELECT ID, VALVE_ID, LPU, LES, PIPE, STATION, TYPE_ID, OPER_TYPE_ID, TECH_NUM, JOINT_ID, NOM_DIAM_ID, NOM_PRESS_ID, SERIAL_NUM, MANUF_ID, DATE_MANUF, VALVE_MATERIAL_TYPE_CL, INSTALL_TYPE_ID, TPA_FIGURE_TYPE_ID, TPA_CONSTR_TYPE_ID, DATE_INSTALL, CLIMATIC_TYPE_ID, LIFETIME, OPER_MANUF_ID, OPER_DATE_MANUF, OPER_LABEL_TYPE_ID, OPER_SERIAL_NUMBER, OPER_DATE_WORK_BEGIN
FROM SUTSTPA.MISMATCH_EXEC_DATA where {FILTER}
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
		<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="LPU" default="" type="String"/> 
                <var name="LES" default="" type="String"/>
                <var name="PIPE" default="" type="String"/>
                <var name="STATION" default="" type="Decimal"/>
                <var name="TYPE_ID" default="" type="String"/>
                <var name="OPER_TYPE_ID" default="" type="String"/>
                <var name="TECH_NUM" default="" type="String"/>
                <var name="JOINT_ID" default="" type="String"/>
                <var name="NOM_DIAM_ID" default="" type="Decimal"/>
                <var name="NOM_PRESS_ID" default="" type="Decimal"/>
                <var name="SERIAL_NUM" default="" type="String"/>
                <var name="MANUF_ID" default="" type="String"/>
                <var name="DATE_MANUF" default="" type="DateTime"/>
                <var name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
                <var name="INSTALL_TYPE_ID" default="" type="String"/>
                <var name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
                <var name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
                <var name="DATE_INSTALL" default="" type="DateTime"/>
                <var name="CLIMATIC_TYPE_ID" default="" type="String"/>
                <var name="LIFETIME" default="" type="Decimal"/>
                <var name="OPER_MANUF_ID" default="" type="String"/>
                <var name="OPER_DATE_MANUF" default="" type="DateTime"/>
                <var name="OPER_LABEL_TYPE_ID" default="" type="String"/>
                <var name="OPER_SERIAL_NUMBER" default="" type="String"/>
                <var name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(id) id FROM sutstpa.MISMATCH_EXEC_DATA"/>
                <query>
				INSERT INTO SUTSTPA.MISMATCH_EXEC_DATA
(VALVE_ID, LPU, LES, PIPE, STATION, TYPE_ID, OPER_TYPE_ID, TECH_NUM, JOINT_ID, NOM_DIAM_ID, NOM_PRESS_ID, SERIAL_NUM, MANUF_ID, DATE_MANUF, VALVE_MATERIAL_TYPE_CL, INSTALL_TYPE_ID, TPA_FIGURE_TYPE_ID, TPA_CONSTR_TYPE_ID, DATE_INSTALL,
 CLIMATIC_TYPE_ID, LIFETIME, OPER_MANUF_ID, OPER_DATE_MANUF, OPER_LABEL_TYPE_ID, OPER_SERIAL_NUMBER, OPER_DATE_WORK_BEGIN)
VALUES({VALVE_ID}, '{LPU}', '{LES}', '{PIPE}', {STATION}, '{TYPE_ID}', '{OPER_TYPE_ID}', '{TECH_NUM}', '{JOINT_ID}', {NOM_DIAM_ID}, {NOM_PRESS_ID}, '{SERIAL_NUM}', '{MANUF_ID}', '{DATE_MANUF}', '{VALVE_MATERIAL_TYPE_CL}', '{INSTALL_TYPE_ID}', '{TPA_FIGURE_TYPE_ID}', '{TPA_CONSTR_TYPE_ID}', '{DATE_INSTALL}',
 '{CLIMATIC_TYPE_ID}', {LIFETIME}, '{OPER_MANUF_ID}', '{OPER_DATE_MANUF}', '{OPER_LABEL_TYPE_ID}', '{OPER_SERIAL_NUMBER}', '{OPER_DATE_WORK_BEGIN}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
		<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="LPU" default="" type="String"/> 
                <var name="LES" default="" type="String"/>
                <var name="PIPE" default="" type="String"/>
                <var name="STATION" default="" type="Decimal"/>
                <var name="TYPE_ID" default="" type="String"/>
                <var name="OPER_TYPE_ID" default="" type="String"/>
                <var name="TECH_NUM" default="" type="String"/>
                <var name="JOINT_ID" default="" type="String"/>
                <var name="NOM_DIAM_ID" default="" type="Decimal"/>
                <var name="NOM_PRESS_ID" default="" type="Decimal"/>
                <var name="SERIAL_NUM" default="" type="String"/>
                <var name="MANUF_ID" default="" type="String"/>
                <var name="DATE_MANUF" default="" type="DateTime"/>
                <var name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
                <var name="INSTALL_TYPE_ID" default="" type="String"/>
                <var name="TPA_FIGURE_TYPE_ID" default="" type="String"/>
                <var name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
                <var name="DATE_INSTALL" default="" type="DateTime"/>
                <var name="CLIMATIC_TYPE_ID" default="" type="String"/>
                <var name="LIFETIME" default="" type="Decimal"/>
                <var name="OPER_MANUF_ID" default="" type="String"/>
                <var name="OPER_DATE_MANUF" default="" type="DateTime"/>
                <var name="OPER_LABEL_TYPE_ID" default="" type="String"/>
                <var name="OPER_SERIAL_NUMBER" default="" type="String"/>
                <var name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
                <var name="ID" type="Int64"/>
                <query>
				UPDATE SUTSTPA.MISMATCH_EXEC_DATA
SET VALVE_ID={VALVE_ID}, LPU='{LPU}', LES='{LES}', PIPE='{PIPE}', STATION={STATION}, TYPE_ID='{TYPE_ID}', OPER_TYPE_ID='{OPER_TYPE_ID}', TECH_NUM='{TECH_NUM}', JOINT_ID='{JOINT_ID}', NOM_DIAM_ID={NOM_DIAM_ID}, NOM_PRESS_ID={NOM_PRESS_ID}, 
SERIAL_NUM='{SERIAL_NUM}', MANUF_ID='{MANUF_ID}', DATE_MANUF='{DATE_MANUF}', VALVE_MATERIAL_TYPE_CL='{VALVE_MATERIAL_TYPE_CL}', INSTALL_TYPE_ID='{INSTALL_TYPE_ID}', TPA_FIGURE_TYPE_ID='{TPA_FIGURE_TYPE_ID}', TPA_CONSTR_TYPE_ID='{TPA_CONSTR_TYPE_ID}', 
DATE_INSTALL='{DATE_INSTALL}', CLIMATIC_TYPE_ID='{CLIMATIC_TYPE_ID}', LIFETIME={LIFETIME}, OPER_MANUF_ID='{OPER_MANUF_ID}', OPER_DATE_MANUF='{OPER_DATE_MANUF}', OPER_LABEL_TYPE_ID='{OPER_LABEL_TYPE_ID}', OPER_SERIAL_NUMBER='{OPER_SERIAL_NUMBER}', 
OPER_DATE_WORK_BEGIN='{OPER_DATE_WORK_BEGIN}'
WHERE ID={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.MISMATCH_EXEC_DATA
                    WHERE id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>	
		 <data table="MISMATCH_INF_DATA" schema="SUTSTPA" id="SUTSTPA_MISMATCH_INF_DATA" comment="MISMATCH_INF_DATA">
        <select>
            <dbQuery idField="ID">
                <var name="FILTER" default="1=1"/>
                <query>
				select * from (SELECT t.INF_ID ID,t.* from SUTSTPA.MISMATCH_INF_DATA t) d where {FILTER}
                </query>
            </dbQuery>
        </select>
        <insert>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INF_DATA"/> 
<var name="POLICY" default="POLICY.xml#INSERT_SUTSTPA"/>
				<var name="INF_ID" default="" type="Decimal"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="LPU" default="" type="String"/> 
                <var name="PIPE" default="" type="String"/>
                <var name="STATION" default="" type="Decimal"/>
                <var name="TYPE_ID" default="" type="String"/>
                <var name="OPER_TYPE_ID" default="" type="String"/>
                <var name="TECH_NUM" default="" type="String"/>
                <var name="JOINT_ID" default="" type="String"/>
                <var name="NOM_DIAM_ID" default="" type="Decimal"/>
                <var name="NOM_PRESS_ID" default="" type="Decimal"/>
                <var name="SERIAL_NUM" default="" type="String"/>
                <var name="MANUF_ID" default="" type="String"/>
                <var name="DATE_MANUF" default="" type="DateTime"/>
                <var name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
                <var name="INSTALL_TYPE_ID" default="" type="String"/>
                <var name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
                <var name="DATE_INSTALL" default="" type="DateTime"/>
                <var name="CLIMATIC_TYPE_ID" default="" type="String"/>
                <var name="LIFETIME" default="" type="Decimal"/>
                <var name="OPER_MANUF_ID" default="" type="String"/>
                <var name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
				<var name="DATE_WORK_BEGIN" default="" type="DateTime"/>
				<var name="INVENT_NUMBER" default="" type="String"/>
				<var name="DATE_EXP" default="" type="DateTime"/>				
				<var name="PRIM" default="" type="String"/>
				<var name="NAME_ID" default="" type="String"/>
				<var name="MEST" default="" type="String"/>
                <var name="ID" type="Int64" direction="Output" default="SELECT max(inf_id) id FROM sutstpa.MISMATCH_INF_DATA"/>
                <query>
				INSERT INTO SUTSTPA.MISMATCH_INF_DATA
(INF_ID, VALVE_ID, LPU, PIPE, STATION, TYPE_ID, OPER_TYPE_ID, NAME_ID, MEST, TECH_NUM, JOINT_ID, NOM_DIAM_ID, NOM_PRESS_ID, SERIAL_NUM, MANUF_ID, DATE_MANUF, VALVE_MATERIAL_TYPE_CL, INSTALL_TYPE_ID, TPA_CONSTR_TYPE_ID, 
				   DATE_INSTALL, CLIMATIC_TYPE_ID, LIFETIME, OPER_MANUF_ID, OPER_DATE_WORK_BEGIN, DATE_WORK_BEGIN, INVENT_NUMBER, DATE_EXP, PRIM)
VALUES({INF_ID}, {VALVE_ID}, '{LPU}', '{PIPE}', {STATION}, '{TYPE_ID}', '{OPER_TYPE_ID}', '{NAME_ID}', '{MEST}', '{TECH_NUM}', '{JOINT_ID}', {NOM_DIAM_ID}, {NOM_PRESS_ID}, '{SERIAL_NUM}', '{MANUF_ID}', '{DATE_MANUF}', '{VALVE_MATERIAL_TYPE_CL}', 
'{INSTALL_TYPE_ID}', '{TPA_CONSTR_TYPE_ID}', '{DATE_INSTALL}', '{CLIMATIC_TYPE_ID}', {LIFETIME}, '{OPER_MANUF_ID}', '{OPER_DATE_WORK_BEGIN}', '{DATE_WORK_BEGIN}', '{INVENT_NUMBER}', '{DATE_EXP}', '{PRIM}')
                </query>
            </dbCommand>
        </insert>
        <update>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INF_DATA"/> 
<var name="POLICY" default="POLICY.xml#UPDATE_SUTSTPA"/>
				<var name="INF_ID" default="" type="Decimal"/>
				<var name="VALVE_ID" default="" type="Decimal"/>
                <var name="LPU" default="" type="String"/> 
                <var name="PIPE" default="" type="String"/>
                <var name="STATION" default="" type="Decimal"/>
                <var name="TYPE_ID" default="" type="String"/>
                <var name="OPER_TYPE_ID" default="" type="String"/>
                <var name="TECH_NUM" default="" type="String"/>
                <var name="JOINT_ID" default="" type="String"/>
                <var name="NOM_DIAM_ID" default="" type="Decimal"/>
                <var name="NOM_PRESS_ID" default="" type="Decimal"/>
                <var name="SERIAL_NUM" default="" type="String"/>
                <var name="MANUF_ID" default="" type="String"/>
                <var name="DATE_MANUF" default="" type="DateTime"/>
                <var name="VALVE_MATERIAL_TYPE_CL" default="" type="String"/>
                <var name="INSTALL_TYPE_ID" default="" type="String"/>
                <var name="TPA_CONSTR_TYPE_ID" default="" type="String"/>
                <var name="DATE_INSTALL" default="" type="DateTime"/>
                <var name="CLIMATIC_TYPE_ID" default="" type="String"/>
                <var name="LIFETIME" default="" type="Decimal"/>
                <var name="OPER_MANUF_ID" default="" type="String"/>
                <var name="OPER_DATE_WORK_BEGIN" default="" type="DateTime"/>
				<var name="DATE_WORK_BEGIN" default="" type="DateTime"/>
				<var name="INVENT_NUMBER" default="" type="String"/>
				<var name="DATE_EXP" default="" type="DateTime"/>				
				<var name="PRIM" default="" type="String"/>
				<var name="NAME_ID" default="" type="String"/>
				<var name="MEST" default="" type="String"/>
                <var name="ID" type="Int64"/>
                <query>
				UPDATE SUTSTPA.MISMATCH_INF_DATA
SET VALVE_ID={VALVE_ID}, LPU='{LPU}', PIPE='{PIPE}', STATION={STATION}, TYPE_ID='{TYPE_ID}', OPER_TYPE_ID='{OPER_TYPE_ID}', NAME_ID='{OPER_TYPE_ID}', MEST='{MEST}', TECH_NUM='{TECH_NUM}', JOINT_ID='{JOINT_ID}', NOM_DIAM_ID={NOM_DIAM_ID}, 
NOM_PRESS_ID={NOM_PRESS_ID}, SERIAL_NUM='{SERIAL_NUM}', MANUF_ID='{MANUF_ID}', DATE_MANUF='{DATE_MANUF}', VALVE_MATERIAL_TYPE_CL='{VALVE_MATERIAL_TYPE_CL}', INSTALL_TYPE_ID='{INSTALL_TYPE_ID}', TPA_CONSTR_TYPE_ID='{TPA_CONSTR_TYPE_ID}', 
DATE_INSTALL='{DATE_INSTALL}', CLIMATIC_TYPE_ID='{CLIMATIC_TYPE_ID}', LIFETIME={LIFETIME}, OPER_MANUF_ID='{OPER_MANUF_ID}', OPER_DATE_WORK_BEGIN='{OPER_DATE_WORK_BEGIN}', DATE_WORK_BEGIN='{DATE_WORK_BEGIN}', INVENT_NUMBER='{INVENT_NUMBER}', 
DATE_EXP='{INVENT_NUMBER}', PRIM='{PRIM}'
WHERE INF_ID={ID}
                </query>
            </dbCommand>
        </update>
        <delete>
            <dbCommand>
<var name="CLASS_ID" type="String" direction="Input" default="SUTSTPA_MISMATCH_INF_DATA"/> 
<var name="POLICY" default="POLICY.xml#DELETE_SUTSTPA"/>
                <param name="ID" type="Int64" direction="Input"/>
                <query>
                    DELETE FROM sutstpa.MISMATCH_INF_DATA
                    WHERE inf_id=:ID
                </query>
            </dbCommand>
        </delete>
    </data>	
</root>    